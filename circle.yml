machine:
  services:
    - docker
  environment:
    PATH: "~/jdk1.8.0_144/bin:~/apache-maven-3.3.9:~/apache-maven-3.3.9/bin"

dependencies:
  cache_directories:
    - ~/jdk1.8.0_144
  pre:
    # Install Java
    - if ! java -version | grep version; then curl -o ~/jdk1.8.0_101.tar.gz http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jdk-8u144-linux-x64.tar.gz; tar -xvzf ~/jdk1.8.0_144.tar.gz -C $HOME/; export JAVA_HOME=~/jdk1.8.0_144; fi
    # Install Maven
    - if ! mvn --version | grep version; then wget http://apache.cs.utah.edu/maven/maven-3/$MAVEN_VERSION/binaries/apache-maven-3.3.9-bin.tar.gz; tar -zxvf apache-maven-3.3.9-bin.tar.gz; export M2_HOME=~/apache-maven-3.3.9; fi

test:
  override:
    - mvn clean package

deployment:
  non_prod:
    branch: master
    commands:
      - ENV=dev ./scripts/deploy.sh:
          timeout: 1800

notify:
  webhooks:
    - url: https://webhook.atomist.com/atomist/circle
